<!DOCTYPE html>
<html>
<head>
    <title>Dungeon Explorer</title>
    <style>
        .controls { margin: 20px; text-align: center; }
        .direction-buttons { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; }
        button { padding: 15px; font-size: 16px; cursor: pointer; }
        #east { grid-column: 1; }
        #west { grid-column: 1; }
        #north { grid-column: 2; }
        #south { grid-column: 2; }
        #debug-toggle { grid-column: 3; }
        #reset { grid-column: 3; }
        #dungeon-map { max-width: 100%; display: block; margin: 0 auto; border: 2px solid #333; }
        .debug-controls { margin: 15px; text-align: center; }
        .position-info { margin: 10px; text-align: center; font-family: monospace; }
    </style>
</head>
<body>
    <div class="controls">
        <div class="direction-buttons">
            <button id="north">↑ North</button>
            <button id="west">← West</button>
            <button id="east">East →</button>
            <button id="south">↓ South</button>
        </div>
    </div>
    
    <div class="debug-controls">
        <button id="debug-toggle">Toggle Debug View</button>
        <button id="reset">Generate New Dungeon</button>
    </div>
    
    <img id="dungeon-map" src="" alt="Dungeon Map">
    
    <div class="position-info">
        <p>Position: <span id="position">(?, ?)</span></p>
    </div>

    <script>
        let debugMode = false;
        
        // Initialize the map
        function updateMap() {
            const map = document.getElementById('dungeon-map');
            // Use correct API path with prefix
            map.src = `/api/dungeon-image?debug=${debugMode}&t=${new Date().getTime()}`;
        }

        // Move party
        function move(direction) {
            // Use correct API path with prefix
            fetch(`/api/move/${direction}`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateMap();
                    } else {
                        alert(data.message);
                    }
                });
        }

        // Reset dungeon
        function resetDungeon() {
            // Use correct API path with prefix
            fetch('/api/reset', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        debugMode = false;
                        updateMap();
                    }
                });
        }

        // Setup event listeners
        document.getElementById('north').addEventListener('click', () => move('north'));
        document.getElementById('south').addEventListener('click', () => move('south'));
        document.getElementById('east').addEventListener('click', () => move('east'));
        document.getElementById('west').addEventListener('click', () => move('west'));
        
        document.getElementById('debug-toggle').addEventListener('click', () => {
            debugMode = !debugMode;
            updateMap();
        });
        
        document.getElementById('reset').addEventListener('click', resetDungeon);

        // Initialize on load
        window.addEventListener('load', updateMap);
    </script>
</body>
</html>